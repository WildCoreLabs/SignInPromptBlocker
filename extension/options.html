<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>No Google Sign-In Prompt – Options</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, "Helvetica Neue", sans-serif; padding: 16px; }
      h3 { margin-top: 0; }
      input { padding: 8px; width: 280px; }
      button { padding: 8px 12px; margin-left: 6px; }
      ul { padding-left: 18px; }
      li { margin: 6px 0; }
      .small { font-size: 12px; color: #666; }
    </style>
  </head>
  <body>
    <h3>Allowlist Domains</h3>
    <p>Sites listed here won’t be blocked (e.g., <code>example.com</code>).</p>
    <div>
      <input id="domain" placeholder="example.com">
      <button id="add">Add</button>
    </div>
    <ul id="list"></ul>

    <hr>
    <h3>Smart Redirects</h3>
    <label><input type="checkbox" id="smartRedirects"> Open Google Maps links in Apple Maps</label>
    <p class="small">When enabled, clicking Google Maps links will open Apple Maps instead.</p>

    <script>
      const listEl = document.getElementById('list');
      const input = document.getElementById('domain');
      const addBtn = document.getElementById('add');
      const smartCb = document.getElementById('smartRedirects');

      async function load() {
        const st = await chrome.storage.local.get({ allowlist: [], smartRedirects: false });
        render(st.allowlist || []);
        smartCb.checked = !!st.smartRedirects;
      }

      function render(list) {
        listEl.innerHTML = '';
        list.forEach((d, i) => {
          const li = document.createElement('li');
          li.textContent = d + ' ';
          const rm = document.createElement('button');
          rm.textContent = 'Remove';
          rm.onclick = async () => {
            const store = await chrome.storage.local.get({ allowlist: [] });
            const cur = store.allowlist || [];
            cur.splice(i, 1);
            await chrome.storage.local.set({ allowlist: cur });
            load();
          };
          li.appendChild(rm);
          listEl.appendChild(li);
        });
      }

      addBtn.onclick = async () => {
        const d = input.value.trim()
          .replace(/^https?:\/\//,'')
          .replace(/\/.*$/,'')
          .replace(/^www\./,'');
        if (!d) return;
        const store = await chrome.storage.local.get({ allowlist: [] });
        const list = store.allowlist || [];
        if (!list.includes(d)) {
          list.push(d);
          await chrome.storage.local.set({ allowlist: list });
          input.value = '';
          load();
        }
      };

      smartCb.addEventListener('change', async (e) => {
        await chrome.storage.local.set({ smartRedirects: !!e.target.checked });
      });

      load();
    </script>
  </body>
</html>
